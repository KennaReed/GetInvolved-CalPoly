{"version":3,"file":"use-file-picker.cjs.development.js","sources":["../src/useFilePicker.tsx"],"sourcesContent":["import { useEffect, useState } from 'react';\r\nimport { fromEvent, FileWithPath } from 'file-selector';\r\nimport { UseFilePickerConfig, FileContent, FilePickerReturnTypes, FileError } from './interfaces';\r\n\r\nfunction useFilePicker({ accept = '*', multiple = true, minFileSize, maxFileSize }: UseFilePickerConfig): FilePickerReturnTypes {\r\n  const [files, setFiles] = useState<FileWithPath[]>([]);\r\n  const [filesContent, setFilesContent] = useState<FileContent[]>([]);\r\n  const [fileErrors, setFileErrors] = useState<FileError[]>([]);\r\n  const [loading, setLoading] = useState<boolean>(false);\r\n\r\n  const openFileSelector = () => {\r\n    const fileExtensions = accept instanceof Array ? accept.join(',') : accept;\r\n    openFileDialog(fileExtensions, multiple, evt => {\r\n      fromEvent(evt).then(files => {\r\n        setFiles(files as FileWithPath[]);\r\n      });\r\n    });\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (files.length === 0) {\r\n      setFilesContent([]);\r\n      return;\r\n    }\r\n    setLoading(true);\r\n    const filePromises = files.map(\r\n      (file: FileWithPath) =>\r\n        new Promise((resolve: (fileContent: FileContent) => void, reject: (reason: FileError) => void) => {\r\n          const reader = new FileReader();\r\n          reader.readAsText(file);\r\n\r\n          reader.onload = () => {\r\n            if (minFileSize) {\r\n              const minBytes = minFileSize * BYTES_PER_MEGABYTE;\r\n              if (file.size < minBytes) {\r\n                addError({ fileSizeTooSmall: true });\r\n              }\r\n            }\r\n            if (maxFileSize) {\r\n              const maxBytes = maxFileSize * BYTES_PER_MEGABYTE;\r\n              if (file.size > maxBytes) {\r\n              }\r\n              addError({ fileSizeToolarge: true });\r\n            }\r\n\r\n            resolve({\r\n              content: reader.result as string,\r\n              name: file.name,\r\n              lastModified: file.lastModified,\r\n            } as FileContent);\r\n          };\r\n          const addError = ({ name = file.name, ...others }: FileError) => {\r\n            reject({ name, fileSizeToolarge: false, fileSizeTooSmall: false, ...others });\r\n          };\r\n        })\r\n    );\r\n    Promise.all(filePromises)\r\n      .then((fileContent: FileContent[]) => {\r\n        setFilesContent(fileContent);\r\n        setFileErrors([]);\r\n      })\r\n      .catch(err => {\r\n        setFileErrors(f => [err, ...f]);\r\n      })\r\n      .finally(() => setLoading(false));\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [files]);\r\n\r\n  return [filesContent, fileErrors, openFileSelector, loading];\r\n}\r\n\r\nexport default useFilePicker;\r\n\r\nfunction openFileDialog(accept: string, multiple: boolean, callback: (arg: any) => void) {\r\n  // this function must be called from  a user\r\n  // activation event (ie an onclick event)\r\n\r\n  // Create an input element\r\n  var inputElement = document.createElement('input');\r\n  // Set its type to file\r\n  inputElement.type = 'file';\r\n  // Set accept to the file types you want the user to select.\r\n  // Include both the file extension and the mime type\r\n  inputElement.accept = accept;\r\n  // Accept multiple files\r\n  inputElement.multiple = multiple;\r\n  // set onchange event to call callback when user has selected file\r\n  inputElement.addEventListener('change', callback);\r\n  // dispatch a click event to open the file dialog\r\n  inputElement.dispatchEvent(new MouseEvent('click'));\r\n}\r\n\r\n//Const values\r\nconst BYTES_PER_MEGABYTE = 1000000;\r\n"],"names":["useFilePicker","accept","multiple","minFileSize","maxFileSize","useState","files","setFiles","filesContent","setFilesContent","fileErrors","setFileErrors","loading","setLoading","openFileSelector","fileExtensions","Array","join","openFileDialog","evt","fromEvent","then","useEffect","length","filePromises","map","file","Promise","resolve","reject","reader","FileReader","readAsText","onload","minBytes","BYTES_PER_MEGABYTE","size","addError","fileSizeTooSmall","fileSizeToolarge","content","result","name","lastModified","others","all","fileContent","err","f","callback","inputElement","document","createElement","type","addEventListener","dispatchEvent","MouseEvent"],"mappings":"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"}